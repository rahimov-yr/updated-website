import { useState } from 'react'
import './HelpManager.css'

const faqData = [
  {
    id: 'general',
    title: 'Общие вопросы',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как работает админ-панель?',
        a: 'Админ-панель позволяет управлять всем контентом сайта конференции. Вы можете редактировать тексты, добавлять новости, управлять программой мероприятий, настраивать страницы и многое другое. Все изменения сохраняются в базе данных и сразу отображаются на сайте.'
      },
      {
        q: 'Как сохранить изменения?',
        a: 'После внесения изменений нажмите кнопку "Сохранить" или "Сохранить все изменения". Система покажет уведомление об успешном сохранении или ошибке. Важно: изменения не сохраняются автоматически — всегда нажимайте кнопку сохранения!'
      },
      {
        q: 'Что означают языковые вкладки?',
        a: 'Сайт поддерживает три языка: Русский, Английский и Таджикский. При редактировании контента вы увидите вкладки для переключения между языками. Заполните контент для каждого языка отдельно. Если контент на каком-то языке не заполнен, будет отображаться русская версия.'
      },
      {
        q: 'Как отменить изменения?',
        a: 'Если вы ещё не сохранили изменения, просто обновите страницу (F5) — загрузятся данные из базы. Если изменения уже сохранены, вам нужно вручную ввести предыдущие значения.'
      }
    ]
  },
  {
    id: 'homepage',
    title: 'Главная страница',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как изменить заголовок на главной странице?',
        a: 'Перейдите в раздел "Главная страница". В секции "Hero-секция" вы найдете поля для редактирования заголовка, даты, места проведения и цитаты. Переключайтесь между языковыми вкладками для ввода текста на разных языках.'
      },
      {
        q: 'Как изменить фоновое видео?',
        a: 'В разделе "Главная страница" найдите секцию "Видео". Вы можете указать URL видеофайла или вставить ссылку на YouTube. Для YouTube вставьте полную ссылку на видео (например, https://youtube.com/watch?v=xxx).'
      },
      {
        q: 'Как добавить спикера?',
        a: 'Спикеры управляются через отдельную базу данных. Обратитесь к администратору системы для добавления новых спикеров.'
      }
    ]
  },
  {
    id: 'news',
    title: 'Новости',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить новость?',
        a: 'Перейдите в раздел "Новости" и нажмите кнопку "+ Добавить новость". Заполните заголовок, краткое описание и полный текст новости. Не забудьте добавить изображение — оно будет отображаться в списке новостей.'
      },
      {
        q: 'Как загрузить изображение для новости?',
        a: 'При создании/редактировании новости нажмите кнопку "Загрузить изображение" или вставьте URL изображения в соответствующее поле. Рекомендуемый размер: 800x600 пикселей.'
      },
      {
        q: 'Как удалить новость?',
        a: 'Найдите нужную новость в списке и нажмите кнопку "Удалить". Подтвердите удаление в появившемся диалоге. Внимание: удаление необратимо!'
      },
      {
        q: 'Как изменить порядок новостей?',
        a: 'Новости автоматически сортируются по дате публикации — новые отображаются первыми. Чтобы поднять новость вверх, измените её дату публикации.'
      }
    ]
  },
  {
    id: 'program',
    title: 'Программа',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить день в программу?',
        a: 'В разделе "Программа" нажмите "+ Добавить день". Укажите дату и название дня (например, "День 1: Открытие"). Затем добавляйте сессии в этот день.'
      },
      {
        q: 'Как добавить сессию?',
        a: 'Выберите день и нажмите "+ Добавить сессию". Укажите время начала и окончания, название сессии, описание и спикеров. Сессии автоматически сортируются по времени.'
      },
      {
        q: 'Как указать место проведения сессии?',
        a: 'При редактировании сессии найдите поле "Зал/Локация" и укажите название зала или помещения, где будет проходить мероприятие.'
      }
    ]
  },
  {
    id: 'logistics',
    title: 'Логистика',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить отель?',
        a: 'Перейдите в "Логистика" → секция "Отели". Нажмите "+ Добавить отель". Заполните название, описание, количество звёзд, добавьте изображение и удобства (amenities). Не забудьте заполнить данные на всех трёх языках.'
      },
      {
        q: 'Как добавить информацию о транспорте?',
        a: 'В разделе "Логистика" переключитесь на вкладку "Транспорт". Нажмите "+ Добавить" и заполните информацию о способе передвижения: выберите иконку, укажите название и описание на всех языках.'
      },
      {
        q: 'Как редактировать визовую информацию?',
        a: 'В разделе "Логистика" перейдите на вкладку "Виза". Здесь вы можете добавлять и редактировать информационные карточки о визовых требованиях.'
      },
      {
        q: 'Как изменить заголовок секции?',
        a: 'В каждой секции (Отели, Транспорт, Виза, Полезное) есть блок "Заголовок секции" в верхней части. Там вы можете изменить заголовок и подзаголовок для каждого языка.'
      }
    ]
  },
  {
    id: 'contacts',
    title: 'Контакты',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить контактную карточку?',
        a: 'В разделе "Контакты" нажмите "+ Добавить контакт". Выберите иконку, укажите телефон и email, заполните категорию, название и описание на всех языках. Нажмите "Сохранить".'
      },
      {
        q: 'Как изменить карту?',
        a: 'Перейдите на вкладку "Карта" в разделе "Контакты". Вставьте embed-код Google Maps в поле URL. Чтобы получить код: откройте Google Maps → найдите место → нажмите "Поделиться" → "Встроить карту" → скопируйте src из iframe.'
      },
      {
        q: 'Как добавить социальную сеть?',
        a: 'Перейдите на вкладку "Соц. сети". Нажмите "+ Добавить", выберите платформу из списка, вставьте URL вашего профиля. Используйте переключатель для включения/отключения ссылки.'
      }
    ]
  },
  {
    id: 'events',
    title: 'Мероприятия',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить мероприятие?',
        a: 'В разделе "Мероприятия" выберите тип (Основные или Дополнительные) и нажмите "+ Добавить". Заполните название, описание, дату, время и место проведения. Добавьте изображение для привлекательного отображения.'
      },
      {
        q: 'В чём разница между основными и дополнительными мероприятиями?',
        a: 'Основные мероприятия — это ключевые события конференции (пленарные сессии, церемонии). Дополнительные — это сопутствующие активности (экскурсии, культурная программа, нетворкинг).'
      }
    ]
  },
  {
    id: 'waterdecade',
    title: 'Десятилетие воды',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8zm0 18c-3.35 0-6-2.57-6-6.2 0-2.34 1.95-5.44 6-9.14 4.05 3.7 6 6.79 6 9.14 0 3.63-2.65 6.2-6 6.2z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить конференцию в таймлайн?',
        a: 'В разделе "Десятилетие воды" нажмите "+ Добавить конференцию". Укажите год, URL сайта конференции (если есть), заполните название и описание на всех языках. Отметьте галочку "Текущая конференция" для конференции 2026 года.'
      },
      {
        q: 'Как добавить цель десятилетия?',
        a: 'Нажмите "+ Добавить цель" в секции "Цели десятилетия". Выберите иконку из предложенных, заполните название и описание цели на всех трёх языках.'
      },
      {
        q: 'Как изменить годы десятилетия?',
        a: 'Нажмите кнопку "Настройки страницы" в правом верхнем углу. В модальном окне вы найдёте поля "Начальный год" и "Конечный год", а также заголовок и подзаголовок страницы.'
      }
    ]
  },
  {
    id: 'excursions',
    title: 'Экскурсии',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как добавить экскурсию?',
        a: 'В разделе "Экскурсии" нажмите "+ Добавить экскурсию". Заполните название, описание, продолжительность, стоимость. Добавьте привлекательное изображение места.'
      },
      {
        q: 'Как указать включённые услуги?',
        a: 'При редактировании экскурсии найдите секцию "Включено в стоимость". Добавляйте пункты по одному, нажимая кнопку "+". Каждый пункт нужно заполнить на всех языках.'
      }
    ]
  },
  {
    id: 'exhibition',
    title: 'Выставка',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как настроить информацию о выставке?',
        a: 'В разделе "Выставка" вы можете редактировать описание выставочной зоны, добавлять информацию о стендах и экспонатах. Заполните контент на всех трёх языках.'
      }
    ]
  },
  {
    id: 'registrations',
    title: 'Регистрации',
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    ),
    questions: [
      {
        q: 'Как просмотреть заявки на регистрацию?',
        a: 'Перейдите в раздел "Регистрации". Здесь отображается список всех заявок с информацией об участниках: ФИО, организация, email, страна, дата подачи заявки.'
      },
      {
        q: 'Как экспортировать список участников?',
        a: 'В разделе "Регистрации" найдите кнопку "Экспорт" и выберите формат (Excel или CSV). Будет скачан файл со всеми данными участников.'
      },
      {
        q: 'Как изменить статус заявки?',
        a: 'Найдите нужную заявку и нажмите на неё для открытия деталей. Используйте выпадающий список для изменения статуса: "Новая", "Подтверждена", "Отклонена".'
      }
    ]
  }
]

const tips = [
  {
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6C7.8 12.16 7 10.63 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/>
      </svg>
    ),
    title: 'Регулярно сохраняйте',
    text: 'Сохраняйте изменения после каждого редактирования. Несохранённые данные будут потеряны при переходе на другую страницу.'
  },
  {
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
      </svg>
    ),
    title: 'Заполняйте все языки',
    text: 'Для корректного отображения сайта заполняйте контент на всех трёх языках. Пустые поля отображают русскую версию.'
  },
  {
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
      </svg>
    ),
    title: 'Оптимизируйте изображения',
    text: 'Используйте изображения размером не более 1920x1080 пикселей и весом до 500 КБ для быстрой загрузки сайта.'
  },
  {
    icon: (
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l4.59-4.58L18 11l-6 6z"/>
      </svg>
    ),
    title: 'Проверяйте результат',
    text: 'После сохранения откройте сайт в новой вкладке и проверьте, как отображаются ваши изменения.'
  }
]

export default function HelpManager({ embedded = false }) {
  const [activeSection, setActiveSection] = useState('general')
  const [expandedQuestions, setExpandedQuestions] = useState({})
  const [searchQuery, setSearchQuery] = useState('')

  const toggleQuestion = (sectionId, questionIndex) => {
    const key = `${sectionId}-${questionIndex}`
    setExpandedQuestions(prev => ({
      ...prev,
      [key]: !prev[key]
    }))
  }

  const isExpanded = (sectionId, questionIndex) => {
    return expandedQuestions[`${sectionId}-${questionIndex}`] || false
  }

  // Filter questions based on search
  const filteredFaq = searchQuery.trim()
    ? faqData.map(section => ({
        ...section,
        questions: section.questions.filter(
          q => q.q.toLowerCase().includes(searchQuery.toLowerCase()) ||
               q.a.toLowerCase().includes(searchQuery.toLowerCase())
        )
      })).filter(section => section.questions.length > 0)
    : faqData

  const activeData = filteredFaq.find(s => s.id === activeSection) || filteredFaq[0]

  return (
    <div className={`help-manager ${embedded ? 'embedded' : ''}`}>
      {/* Header */}
      <div className="page-manager-header">
        <div className="page-manager-title">
          <h1>Справка</h1>
          <p>Руководство по использованию админ-панели</p>
        </div>
      </div>

      {/* Search */}
      <div className="help-search">
        <div className="help-search-input">
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <input
            type="text"
            placeholder="Поиск по вопросам..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
          {searchQuery && (
            <button className="help-search-clear" onClick={() => setSearchQuery('')}>
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          )}
        </div>
      </div>

      {/* Tips Section */}
      <div className="help-tips">
        <h3>Полезные советы</h3>
        <div className="help-tips-grid">
          {tips.map((tip, index) => (
            <div key={index} className="help-tip-card">
              <div className="help-tip-icon">{tip.icon}</div>
              <div className="help-tip-content">
                <h4>{tip.title}</h4>
                <p>{tip.text}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Main Content */}
      <div className="help-content">
        {/* Sidebar Navigation */}
        <div className="help-sidebar">
          <h3>Разделы</h3>
          <nav className="help-nav">
            {filteredFaq.map(section => (
              <button
                key={section.id}
                className={`help-nav-item ${activeSection === section.id ? 'active' : ''}`}
                onClick={() => setActiveSection(section.id)}
              >
                <span className="help-nav-icon">{section.icon}</span>
                <span className="help-nav-title">{section.title}</span>
                <span className="help-nav-count">{section.questions.length}</span>
              </button>
            ))}
          </nav>
        </div>

        {/* FAQ Content */}
        <div className="help-faq">
          {activeData && (
            <>
              <div className="help-faq-header">
                <span className="help-faq-icon">{activeData.icon}</span>
                <h2>{activeData.title}</h2>
              </div>

              <div className="help-faq-list">
                {activeData.questions.map((item, index) => (
                  <div
                    key={index}
                    className={`help-faq-item ${isExpanded(activeData.id, index) ? 'expanded' : ''}`}
                  >
                    <button
                      className="help-faq-question"
                      onClick={() => toggleQuestion(activeData.id, index)}
                    >
                      <span>{item.q}</span>
                      <svg
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        width="20"
                        height="20"
                        className="help-faq-chevron"
                      >
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                      </svg>
                    </button>
                    <div className="help-faq-answer">
                      <p>{item.a}</p>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}

          {filteredFaq.length === 0 && (
            <div className="help-no-results">
              <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
              <h3>Ничего не найдено</h3>
              <p>Попробуйте изменить поисковый запрос</p>
            </div>
          )}
        </div>
      </div>

      {/* Contact Support */}
      <div className="help-support">
        <div className="help-support-content">
          <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
            <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"/>
          </svg>
          <div>
            <h3>Нужна дополнительная помощь?</h3>
            <p>Если вы не нашли ответ на свой вопрос, обратитесь в техническую поддержку</p>
          </div>
          <a href="mailto:support@dushanbewaterprocess.org" className="btn-support">
            Написать в поддержку
          </a>
        </div>
      </div>
    </div>
  )
}
